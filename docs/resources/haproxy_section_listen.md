---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "roxywi_haproxy_section_listen Resource - roxywi"
subcategory: ""
description: |-
  Manage HAProxy Listen sections. Please note that changes may cause HAProxy to restart.
---

# roxywi_haproxy_section_listen (Resource)

Manage HAProxy Listen sections. Please note that changes may cause HAProxy to restart.



<!-- schema generated by tfplugindocs -->

## Example Usage

```terraform
resource "roxywi_haproxy_section_listen" "example" {
  name      = "example-listen"
  mode      = "tcp"
  balance   = "roundrobin"
  server_id = 1
  headers {
    path   = "http-response"
    method = "add-header"
    name   = "test-header"
    value  = "test"
  }
  binds {
    ip   = "0.0.0.0"
    port = 8088
  }
  backend_servers {
    server     = "127.0.0.1"
    port       = "8080"
    port_check = "8080"
  }
  backend_servers {
    server     = "127.0.0.2"
    port       = "8080"
    port_check = "8080"
  }
}
```

## Schema

### Required

- `balance` (String) Load balancing algorithm. Available values are: `roundrobin`,`source`,`leastconn`,`first`,`rdp-cookie`,`uri`,`uri whole`,`static-rr`,`static-rr`,`url_param userid`.
- `binds` (Block List, Min: 1) List of backend servers configuration. (see [below for nested schema](#nestedblock--binds))
- `name` (String) Name of the Listen section.
- `server_id` (Number) The ID of the server to deploy to.

### Optional

- `acls` (Block List) List of ACLs configuration. (see [below for nested schema](#nestedblock--acls))
- `action` (String) What action should be taken after changing the config. Available: save, reload, restart.
- `antibot` (Boolean) Add Anti Bot settings.
- `backend_servers` (Block List) List of backend servers configuration. (see [below for nested schema](#nestedblock--backend_servers))
- `blacklist` (String) Path to a blacklist.
- `cache` (Boolean) Cache enabling.
- `circuit_breaking` (Block Set) A Set of timeout settings. (see [below for nested schema](#nestedblock--circuit_breaking))
- `compression` (Boolean) HTTP compression allows you to shrink the body of a response before it is relayed to a client, which results in using less network bandwidth per request. From a client's perspective, this reduces latency.
- `cookie` (Block Set) To send a client to the same server where they were sent previously in order to reuse a session on that server, you can enable cookie-based session persistence. Add a cookie directive to the backend section and set the cookie parameter to a unique value on each server line. (see [below for nested schema](#nestedblock--cookie))
- `ddos` (Boolean) DDOS attack protect.
- `forward_for` (Boolean) When HAProxy Enterprise proxies a TCP connection, it overwrites the client's source IP address with its own when communicating with the backend server. However, when relaying HTTP messages, it can store the client's address in the HTTP header X-Forwarded-For. The backend server can then be configured to read the value from that header to retrieve the client's IP address.
- `headers` (Block List) Set custom check parameters. (see [below for nested schema](#nestedblock--headers))
- `health_check` (Block Set) Set custom check parameters. (see [below for nested schema](#nestedblock--health_check))
- `maxconn` (Number) Limits the per-process connection limit.
- `mode` (String) Load balancing mode. Available values are: `tcp`,`http`.
- `redispatch` (Boolean) In HTTP mode, if a server designated by a cookie is down, clients may definitely stick to it because they cannot flush the cookie, so they will not be able to access the service anymore. Specifying 'option redispatch' will allow the proxy to break their persistence and redistribute them to a working server. It also allows to retry connections to another server in case of multiple connection failures. Of course, it requires having 'retries' set to a nonzero value.
- `servers_check` (Block Set) Set custom check parameters. (see [below for nested schema](#nestedblock--servers_check))
- `slow_attack` (Boolean) In a Slow POST attack, an attacker begins by sending a legitimate HTTP POST header to a Web server, exactly as they would under normal circumstances. The header specifies the exact size of the message body that will then follow. However, that message body is then sent at an alarmingly low rate â€“ sometimes as slow as 1 byte per approximately two minutes.
- `ssl` (Block Set) SSL settings. (see [below for nested schema](#nestedblock--ssl))
- `ssl_offloading` (Boolean) Enable redirection from HTTP scheme to HTTPS scheme.
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))
- `waf` (Boolean) Add WAF settings.
- `whitelist` (String) Path to a whitelist.

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--binds"></a>
### Nested Schema for `binds`

Required:

- `port` (Number) Port for binding listener.

Optional:

- `ip` (String) IP for binding listener.


<a id="nestedblock--acls"></a>
### Nested Schema for `acls`

Required:

- `acl_if` (Number) If statement: 1: 'hdr_beg(host) -i', 2: 'hdr_end(host) -i', 3: 'path_beg -i', 4: 'path_end -i', 6: 'src ip'.
- `acl_then` (Number) Then statement: 2: 'http-request redirect location', 3:'http-request allow', 4: 'http-request deny', 5: 'use_backend'.
- `acl_value` (String) If value.

Optional:

- `acl_then_value` (String) Then value.


<a id="nestedblock--backend_servers"></a>
### Nested Schema for `backend_servers`

Required:

- `port` (Number) Backend server port.
- `port_check` (Number) Backend port for check. Usually the same as the backend_port.
- `server` (String) Backend server address.

Optional:

- `backup` (Boolean) Is this server backup server?
- `maxconn` (Number) Maximun connection to the server.
- `send_proxy` (Boolean) Enable Send proxy option for this backend server. Only for HTTP mode.


<a id="nestedblock--circuit_breaking"></a>
### Nested Schema for `circuit_breaking`

Required:

- `error_limit` (Number) Number of errors considered as the threshold.
- `observe` (String) Monitor live traffic for HTTP or TCP. Available values are: `layer7`,`layer4`.
- `on_error` (String) Actions. Available values are: `mark-down`,`fastinter`, `fail-check`, `sudden-death`.


<a id="nestedblock--cookie"></a>
### Nested Schema for `cookie`

Optional:

- `domain` (String) This option allows to specify the domain at which a cookie is inserted. It requires exactly one parameter: a valid domain name.
- `dynamic` (String) Set the dynamic cookie secret key for a backend.
- `dynamic_key` (String) Activate dynamic cookies. When used, a session cookie is dynamically created for each server, based on the IP and port of the server, and a secret key, specified in the "dynamic-cookie-key" backend directive.
- `name` (String) Is the name of the cookie which will be monitored, modified or inserted in order to bring persistence.
- `nocache` (String) This option is recommended in conjunction with the insert mode when there is a cache between the client and HAProxy, as it ensures that a cacheable response will be tagged non-cacheable if a cookie needs to be inserted.
- `postonly` (String) This option ensures that cookie insertion will only be performed on responses to POST requests. It is an alternative to the "nocache" option, because POST responses are not cacheable, so this ensures that the persistence cookie will never get cached.
- `prefix` (String) This keyword indicates that instead of relying on a dedicated cookie for the persistence, an existing one will be completed.


<a id="nestedblock--headers"></a>
### Nested Schema for `headers`

Required:

- `method` (String) Header method. Could be: add-header, set-header, del-header
- `name` (String) Header name
- `path` (String) Header. Could be: http-response, http-request
- `value` (String) Header value. Leave blank if using del-header.


<a id="nestedblock--health_check"></a>
### Nested Schema for `health_check`

Required:

- `check` (String) Custom check type. Could be: tcp-check, ssl-hello-chk, httpchk, ldap-check, mysql-check, pgsql-check, redis-check, smtpchk

Optional:

- `domain` (String) Domain name. Only for HTTP check.
- `path` (String) URI path for checking. Only for HTTP check.


<a id="nestedblock--servers_check"></a>
### Nested Schema for `servers_check`

Required:

- `fall` (Number) The 'fall' parameter states that a server will be considered as dead after <count> consecutive unsuccessful health checks. This value defaults to 5 if unspecified.
- `inter` (Number) The "inter" parameter sets the interval between two consecutive health checks to <delay> milliseconds. If left unspecified, the delay defaults to 2000 ms.
- `rise` (Number) The 'rise' parameter states that a server will be considered as operational after <count> consecutive successful health checks. This value defaults to 2 if unspecified.


<a id="nestedblock--ssl"></a>
### Nested Schema for `ssl`

Required:

- `cert` (String) Path to the pem file.
- `ssl_check_backend` (Number) Disable SSL verify on servers.


<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)
- `update` (String)


## Import

In Terraform v1.7.0 and later, use an import block to import Group. For example:

```terraform
import {
  to = roxywi_haproxy_section_listen.example
  id = "1-example-listen"
}
```

Using terraform import, import Group can be imported using the `id`, e.g. For example:

```shell
% terraform import roxywi_haproxy_section_listen.example 1-example-listen
```
